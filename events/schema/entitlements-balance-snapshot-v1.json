{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "description": "OpenMeter Events Schema",
  "type": "object",
  "additionalProperties": {
    "cloudevents.type": "openmeter.entitlements.balance.snapshot.v1"
  },
  "properties": {
    "entitlementId": {
      "description": "ID of the entitlement in ULID format.",
      "$ref": "types.json#definitions/ulid"
    },
    "namespace": {
      "description": "Namespace of the entitlement.",
      "type": "string"
    },
    "subject": {
      "description": "Subject of the entitlement we are reporting the balance for",
      "type": "string"
    },
    "feature": {
      "description": "Feature of the entitlement we are reporting the balance for",
      "type": "string"
    },
    "operation": {
      "description": "The type of the operation triggering this balance change TODO: we might want to make this specific to the balance payload",
      "type": "string",
      "enum": [
        "UPDATE",
        "DELETE"
      ]
    },
    "balance": {
      "type": "object",
      "properties": {
        "balance": {
          "description": "The balance of the entitlement",
          "type": "number"
        },
        "config": {
          "description": "The configuration of the entitlement, TODO: object",
          "type": "string"
        },
        "hasAccess": {
          "description": "Whether the subject has access to the feature",
          "type": "boolean"
        },
        "overage": {
          "description": "The overage of the entitlement",
          "type": "number"
        },
        "usage": {
          "description": "The usage of the entitlement",
          "type": "number"
        }
      }
    },
    "currentUsagePeriod": {
      "description": "The current usage period of the entitlement",
      "$ref": "types.json#definitions/period"
    }
  },
  "required": [
    "entitlementId",
    "namespace",
    "subject",
    "feature"
  ]
}
